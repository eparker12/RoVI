---
title: "Analysis module 6: 16S microbiota composition vs demography, growth and birthmode"
author: "RoVI study"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  flexdashboard::flex_dashboard:
    self_contained: yes
    theme: flatly 
---

Sidebar {.sidebar} 
===================================== 
[Sample summary]    

[India]    

[Malawi]

[UK]    

[Plot - all countries]    

[Alpha diversity vs neonatal RV]    

[Session info]



Sample summary {.hidden}
=====================================

```{r, message=FALSE}
# variable to define whether to run analyses in full (TRUE) or not (FALSE)
run_beta_full = TRUE # set as TRUE to run beta diversity analyses in full

# load packages and functions
source("input/packages_and_functions.R")
source("input/RF_functions.R")
#source("input/functions_module6.R")

# load genus/rsv-level data - full and rarefied
load("phyloseq_files/ps7_genus.RData")
load("phyloseq_files/ps7_l_t_pr_d_dd_25k.RData")
load("phyloseq_files/ps8_genus.RData")
load("phyloseq_files/ps8_l_t_pr_d_dd_25k_rarefied.RData")

# select BS1, BS2, BS3, BS5 and MS1 samples within each phyloseq object
ps7_genus = subset_samples(ps7_genus, (!is.na(dose1_shedding) | !is.na(seroconv)) & (sample_type=="BS1" | sample_type=="BS2" | sample_type=="BS3" | sample_type=="BS5" | sample_type=="MS1")) %>% prune_taxa(taxa_sums(.) > 0, .)
ps7 = subset_samples(ps7_l_t_pr_d_dd_25k, (!is.na(dose1_shedding) | !is.na(seroconv)) & (sample_type=="BS1" | sample_type=="BS2" | sample_type=="BS3" | sample_type=="BS5" | sample_type=="MS1")) %>% prune_taxa(taxa_sums(.) > 0, .)
ps8_genus = subset_samples(ps8_genus, (!is.na(dose1_shedding) | !is.na(seroconv)) & (sample_type=="BS1" | sample_type=="BS2" | sample_type=="BS3" | sample_type=="BS5" | sample_type=="MS1")) %>% prune_taxa(taxa_sums(.) > 0, .)
ps8 = subset_samples(ps8_l_t_pr_d_dd_25k_rarefied, (!is.na(dose1_shedding) | !is.na(seroconv)) & (sample_type=="BS1" | sample_type=="BS2" | sample_type=="BS3" | sample_type=="BS5" | sample_type=="MS1")) %>% prune_taxa(taxa_sums(.) > 0, .)
#all(sample_names(ps7_genus)==sample_names(ps8_genus))

# transform to relative abundances
rps7_genus = transform_sample_counts(ps7_genus, function(x) {x/sum(x)})
rps7 = transform_sample_counts(ps7, function(x) {x/sum(x)})
rps8_genus = transform_sample_counts(ps8_genus, function(x) {x/sum(x)})
rps8 = transform_sample_counts(ps8, function(x) {x/sum(x)})

# load RoVI metadata and recode factors
a = read.csv("input/RoVI_metadata_by_family_03112020.csv", header=T)
a$family_ID = as.character(a$family_ID)
a$BS1_VP6_cat[!is.na(a$BS1_VP6_cat)] = factor(a$BS1_VP6_cat)[!is.na(a$BS1_VP6_cat)]
a$sex_baby = factor(a$sex_baby, levels=c("male", "female"))
a$crowding_wami = factor(a$crowding_wami, levels=c("up_to_4", "over_4"))
a$mode_delivery = factor(a$mode_delivery, levels=c("vaginal", "caesarean"))
a$breastfed_child = factor(a$breastfed_child, levels=c("nonexclusive", "exclusive"))
a$pre_exposed = factor(a$pre_exposed)
levels(a$pre_exposed) <- c("no", "yes")

# recode 'unknown' as NA for water treatment status and HIV status
a$water_treat_wami[a$water_treat_wami=="unknown"] = NA
a$water_treat_wami = droplevels(a$water_treat_wami)
sample_data(rps8)$water_treat_wami[sample_data(rps8)$water_treat_wami=="unknown"] = NA
a$HIV_status[a$HIV_status=="unknown"] = NA
a$HIV_status = droplevels(a$HIV_status)
sample_data(rps8)$HIV_status[sample_data(rps8)$HIV_status=="unknown"] = NA

# append pre-vaccination diversity metrics
t = data.frame(sample_data(rps8_genus))
t_6w = subset(t, sample_type=="BS3")
a = merge(a, t_6w[,c("family_ID", "Shannon", "Observed")], by = "family_ID")
```

#### Input data: infant stools (BS1, BS2, BS3, and BS5) and maternal stool (MS1) 
* n samples = `r nsamples(ps7_genus)`    
* n taxa: genera = `r ntaxa(ps7_genus)`; variants = `r sum(taxa_sums(ps7)>0)` 
* n taxa (rarefied): genera = `r ntaxa(ps8_genus)`; variants = `r sum(taxa_sums(ps8)>0)`  
* mean read count = `r round(mean(sample_sums(ps7_genus)),0)`, s.d. = `r round(sd(sample_sums(ps7_genus)),0)`



India {.hidden}
=====================================

#### Beta diversity - unweighted Bray-Curtis distances
```{r, fig.width=10, fig.height=8}
### run beta diversity analyses
beta_vars = read.csv("input/beta_variables_reduced.csv", stringsAsFactors = FALSE)
beta_vars = subset(beta_vars, IND==1)

if (run_beta_full) {
  rps_t = subset_samples(rps8_genus, country=="India")
  t = data.frame(sample_data(rps_t))
  ncomp = nrow(beta_vars)
  beta_collated = data.frame(
    age_group = rep("BS3",ncomp), clean_age_group = rep("week of life 6",ncomp),
    variable = beta_vars$BS3, clean_variable = beta_vars$clean_name,
    group = beta_vars$group, R2_u = NA, p_u = NA, n_samples = NA
  )
  for (i in 1:nrow(beta_collated)) {
    if (!is.na(beta_collated$variable[i])) {
      t$outcome = t[,as.character(beta_collated$variable[i])]
      sample_list = as.character(t$sample_ID_full[t$sample_type==beta_collated$age_group[i] & !is.na(t$outcome)])
      
      rps8_sub = prune_samples(sample_list, rps_t) %>% prune_taxa(taxa_sums(.) > 0, .)
      beta = data.frame(sample_data(rps8_sub))
      beta$outcome = beta[,as.character(beta_collated$variable[i])]
      beta_collated$n_samples[i] = length(sample_list)
      
      # unweighted adonis
      otu_table(rps8_sub)[otu_table(rps8_sub)<0.001] = 0
      bray_dist_u = phyloseq::distance(rps8_sub, method = "bray", binary = TRUE)
      adon = adonis(bray_dist_u ~ outcome, data = beta, permutations = 999)
      beta_collated$R2_u[i] = round(adon$aov.tab$R2[1],3)
      beta_collated$p_u[i] = round(adon$aov.tab$`Pr(>F)`[1],3)
    }
  }
  beta_collated$fdr_p_u = round(p.adjust(beta_collated$p_u, method="fdr"),3)
  write.csv(beta_collated, "output_module4/permanova_India_genus_reduced.csv")
} else { beta_collated = read.csv("output_module4/permanova_India_genus_reduced.csv") }

beta_collated$clean_variable = factor(beta_collated$clean_variable, levels = beta_vars$clean_name)
beta_collated$clean_variable = revalue(beta_collated$clean_variable, c("A1AT at 6w (μg/ml)"="α1AT at 6w (μg/ml)","A1AG at 6w (μg/ml)"="α1AG at 6w (μg/ml)"))
beta_collated$group = factor(beta_collated$group, levels = c("maternal", "household", "infant", "rotavirus"))
beta_collated$group = as.character(beta_collated$group)

### run alpha diversity analyses
a$outcome = a$Shannon
a1 = subset(a, country=="India")
alpha_collated = baseline_summary_alpha(a1)
alpha_collated$fdr_alpha_p = round(p.adjust(alpha_collated$p, method="fdr"),3)
write.csv(alpha_collated, "output_module4/India_full_Shannon.csv")

### merge results
summary = merge(alpha_collated, beta_collated, by = "variable")
summary$R2_u[summary$variable=="HIV_status"] = NA
summary$p_u[summary$variable=="HIV_status"] = NA
summary$fdr_p_u[summary$variable=="HIV_status"] = NA

### beta plot
g1 = ggplot(summary, aes(y = R2_u*100, x=clean_variable, fill = group)) + 
  geom_bar(stat = "identity") + 
  scale_x_discrete(limits = rev(levels(summary$clean_variable))) + xlab("") + 
  ylab("R2 (%)") + scale_y_continuous(limits = c(0,8), breaks=c(0,4,8)) + 
  coord_flip() + theme(legend.position="none") +
 scale_fill_manual(values=c(household = "#CC79A7", infant = "#009E73", maternal = "#56B4E9", rotavirus = "#661100")) + ggtitle("PERMANOVA,\nunweighted Bray-Curtis") + 
 # facet_grid(group~., scales = "free", space='free') +
  theme(axis.text.y = element_text(size=17), axis.text.x = element_text(size=18), axis.title = element_text(size=18), 
        legend.text = element_text(size=18), legend.title = element_text(size=18), plot.title = element_text(size=18)) 

### alpha plot
g2 = ggplot(summary, aes(y = as.numeric(beta), x=clean_variable, colour = group)) + 
  geom_point(size = 3) + geom_errorbar(aes(ymin=as.numeric(`lower CI`), ymax=as.numeric(`upper CI`)), width=0, size=0.8, alpha=0.5) +
  scale_x_discrete(limits = rev(levels(summary$clean_variable))) + xlab("") + 
  ylab("beta") + ggtitle("regression,\nShannon") + 
  coord_flip() + scale_y_continuous(trans = 'log10', limits = c(0.5,2), breaks=c(0.5,1,2)) +
  scale_colour_manual(values=c(household = "#CC79A7", infant = "#009E73", maternal = "#56B4E9", rotavirus = "#661100")) + 
 # facet_grid(group~., scales = "free", space='free') +
  theme(axis.text.y = element_blank(), axis.text.x = element_text(size=18), axis.title = element_text(size=18), 
        legend.text = element_text(size=18), legend.title = element_text(size=18), plot.title = element_text(size=18))
```

##### Significant assocations - Bray-Curtis (fdr p <0.05)
```{r}
subset(summary, fdr_p_u<0.05)[,c("clean_variable", "R2_u", "p_u", "fdr_p_u", "n_samples")]
```

##### Significant assocations - Shannon (fdr p <0.05)
```{r}
subset(summary, fdr_alpha_p<0.05)[,c("clean_variable", "beta", "p", "fdr_alpha_p", "n")]
```

##### Full beta results
```{r}
formattable(beta_collated)
```

##### Full alpha results
```{r}
formattable(alpha_collated)
```




Malawi {.hidden}
=====================================

#### Beta diversity - unweighted Bray-Curtis distances
```{r, fig.width=10, fig.heaight=5}
### run beta diversity analyses
beta_vars = read.csv("input/beta_variables_reduced.csv", stringsAsFactors = FALSE)
beta_vars = subset(beta_vars, MLW==1)

if (run_beta_full) {
  rps_t = subset_samples(rps8_genus, country=="Malawi")
  t = data.frame(sample_data(rps_t))
  ncomp = nrow(beta_vars)
  beta_collated = data.frame(
    age_group = rep("BS3",ncomp), clean_age_group = rep("week of life 6",ncomp),
    variable = beta_vars$BS3, clean_variable = beta_vars$clean_name,
    group = beta_vars$group, R2_u = NA, p_u = NA, n_samples = NA
  )
  for (i in 1:nrow(beta_collated)) {
    if (!is.na(beta_collated$variable[i])) {
      t$outcome = t[,as.character(beta_collated$variable[i])]
      sample_list = as.character(t$sample_ID_full[t$sample_type==beta_collated$age_group[i] & !is.na(t$outcome)])
      
      rps8_sub = prune_samples(sample_list, rps_t) %>% prune_taxa(taxa_sums(.) > 0, .)
      beta = data.frame(sample_data(rps8_sub))
      beta$outcome = beta[,as.character(beta_collated$variable[i])]
      beta_collated$n_samples[i] = length(sample_list)
      
      # unweighted adonis
      otu_table(rps8_sub)[otu_table(rps8_sub)<0.001] = 0
      bray_dist_u = phyloseq::distance(rps8_sub, method = "bray", binary = TRUE)
      adon = adonis(bray_dist_u ~ outcome, data = beta, permutations = 999)
      beta_collated$R2_u[i] = round(adon$aov.tab$R2[1],3)
      beta_collated$p_u[i] = round(adon$aov.tab$`Pr(>F)`[1],3)
    }
  }
  beta_collated$fdr_p_u = round(p.adjust(beta_collated$p_u, method="fdr"),3)
  write.csv(beta_collated, "output_module4/permanova_MLW_genus_reduced.csv")
} else { beta_collated = read.csv("output_module4/permanova_MLW_genus_reduced.csv") }

beta_collated$clean_variable = factor(beta_collated$clean_variable, levels = beta_vars$clean_name)
beta_collated$clean_variable = revalue(beta_collated$clean_variable, c("A1AT at 6w (μg/ml)"="α1AT at 6w (μg/ml)","A1AG at 6w (μg/ml)"="α1AG at 6w (μg/ml)"))
beta_collated$group = factor(beta_collated$group, levels = c("maternal", "household", "infant", "rotavirus"))
beta_collated$group = as.character(beta_collated$group)

### run alpha diversity analyses
a$outcome = a$Shannon
a1 = subset(a, country=="Malawi")
alpha_collated = baseline_summary_alpha(a1)
alpha_collated = subset(alpha_collated, n>0)
alpha_collated$fdr_alpha_p[!is.na(alpha_collated$p)] = round(p.adjust(alpha_collated$p[!is.na(alpha_collated$p)], method="fdr"),3)
write.csv(alpha_collated, "output_module4/Malawi_Shannon.csv")

### merge results
summary = merge(alpha_collated, beta_collated, by = "variable")
summary = subset(summary, !is.na(fdr_alpha_p)) %>% droplevels()

### beta plot
g3 = ggplot(summary, aes(y = R2_u*100, x=clean_variable, fill = group)) + 
  geom_bar(stat = "identity") + 
  scale_x_discrete(limits = rev(levels(summary$clean_variable))) + xlab("") + 
  ylab("R2 (%)") + scale_y_continuous(limits = c(0,8), breaks=c(0,4,8)) + 
  coord_flip() + theme(legend.position="none") +
  scale_fill_manual(values=c(household = "#CC79A7", infant = "#009E73", maternal = "#56B4E9", rotavirus = "#661100")) + ggtitle("PERMANOVA,\nunweighted Bray-Curtis") + 
  theme(axis.text.y = element_text(size=17), axis.text.x = element_text(size=18), axis.title = element_text(size=18), 
        legend.text = element_text(size=18), legend.title = element_text(size=18), plot.title = element_text(size=18)) 

### alpha plot
g4 = ggplot(summary, aes(y = as.numeric(beta), x=clean_variable, colour = group)) + 
  geom_point(size = 3) + geom_errorbar(aes(ymin=as.numeric(`lower CI`), ymax=as.numeric(`upper CI`)), width=0, size=0.8, alpha=0.5) +
  scale_x_discrete(limits = rev(levels(summary$clean_variable))) + xlab("") + 
  ylab("beta") + ggtitle("regression,\nShannon") + 
  coord_flip() + scale_y_continuous(trans = 'log10', limits = c(0.33,3), breaks=c(0.5,1,2)) +
  scale_colour_manual(values=c(household = "#CC79A7", infant = "#009E73", maternal = "#56B4E9", rotavirus = "#661100")) + 
  theme(axis.text.y = element_blank(), axis.text.x = element_text(size=18), axis.title = element_text(size=18), 
        legend.text = element_text(size=18), legend.title = element_text(size=18), plot.title = element_text(size=18))
```

##### Significant assocations - Bray-Curtis (fdr p <0.05)
```{r}
subset(summary, fdr_p_u<0.05)[,c("clean_variable", "R2_u", "p_u", "fdr_p_u", "n_samples")]
```

##### Significant assocations - Shannon (fdr p <0.05)
```{r}
subset(summary, fdr_alpha_p<0.05)[,c("clean_variable", "beta", "p", "fdr_alpha_p", "n")]
```

##### Full beta results
```{r}
formattable(beta_collated)
```

##### Full alpha results
```{r}
formattable(alpha_collated)
```




UK {.hidden}
=====================================

#### Beta diversity - unweighted Bray-Curtis distances
```{r, fig.width=10, fig.heaight=5}
### run beta diversity analyses
beta_vars = read.csv("input/beta_variables_reduced.csv", stringsAsFactors = FALSE)
beta_vars = subset(beta_vars, UK==1)

if (run_beta_full) {
  rps_t = subset_samples(rps8_genus, country=="UK")
  t = data.frame(sample_data(rps_t))
  ncomp = nrow(beta_vars)
  beta_collated = data.frame(
    age_group = rep("BS3",ncomp), clean_age_group = rep("week of life 8",ncomp),
    variable = beta_vars$BS3, clean_variable = beta_vars$clean_name,
    group = beta_vars$group, R2_u = NA, p_u = NA, n_samples = NA
  )
  for (i in 1:nrow(beta_collated)) {
    if (!is.na(beta_collated$variable[i])) {
      t$outcome = t[,as.character(beta_collated$variable[i])]
      sample_list = as.character(t$sample_ID_full[t$sample_type==beta_collated$age_group[i] & !is.na(t$outcome)])
      
      rps8_sub = prune_samples(sample_list, rps_t) %>% prune_taxa(taxa_sums(.) > 0, .)
      beta = data.frame(sample_data(rps8_sub))
      beta$outcome = beta[,as.character(beta_collated$variable[i])]
      beta_collated$n_samples[i] = length(sample_list)
      
      # unweighted adonis
      otu_table(rps8_sub)[otu_table(rps8_sub)<0.001] = 0
      bray_dist_u = phyloseq::distance(rps8_sub, method = "bray", binary = TRUE)
      adon = adonis(bray_dist_u ~ outcome, data = beta, permutations = 999)
      beta_collated$R2_u[i] = round(adon$aov.tab$R2[1],3)
      beta_collated$p_u[i] = round(adon$aov.tab$`Pr(>F)`[1],3)
    }
  }
  beta_collated$fdr_p_u = round(p.adjust(beta_collated$p_u, method="fdr"),3)
  write.csv(beta_collated, "output_module4/permanova_UK_genus_reduced.csv")
} else { beta_collated = read.csv("output_module4/permanova_UK_genus_reduced.csv") }

beta_collated$clean_variable = factor(beta_collated$clean_variable, levels = beta_vars$clean_name)
beta_collated$clean_variable = revalue(beta_collated$clean_variable, c("A1AT at 6w (μg/ml)"="α1AT at 6w (μg/ml)","A1AG at 6w (μg/ml)"="α1AG at 6w (μg/ml)"))
beta_collated$group = factor(beta_collated$group, levels = c("maternal", "household", "infant", "rotavirus"))
beta_collated$group = as.character(beta_collated$group)

### run alpha diversity analyses
a$outcome = a$Shannon
a1 = subset(a, country=="UK")
alpha_collated = baseline_summary_alpha(a1)
alpha_collated = subset(alpha_collated, n>0)
alpha_collated$fdr_alpha_p[!is.na(alpha_collated$p)] = round(p.adjust(alpha_collated$p[!is.na(alpha_collated$p)], method="fdr"),3)
write.csv(alpha_collated, "output_module4/UK_Shannon.csv")

### merge results
summary = merge(alpha_collated, beta_collated, by = "variable")
summary = subset(summary, !is.na(fdr_alpha_p)) %>% droplevels()

### beta plot
g5 = ggplot(summary, aes(y = R2_u*100, x=clean_variable, fill = group)) + 
  geom_bar(stat = "identity") + 
  scale_x_discrete(limits = rev(levels(summary$clean_variable))) + xlab("") + 
  ylab("R2 (%)") + scale_y_continuous(limits = c(0,8), breaks=c(0,4,8)) + 
  coord_flip() + theme(legend.position="none") +
  scale_fill_manual(values=c(household = "#CC79A7", infant = "#009E73", maternal = "#56B4E9", rotavirus = "#661100")) +  ggtitle("PERMANOVA,\nunweighted Bray-Curtis") + 
  theme(axis.text.y = element_text(size=17), axis.text.x = element_text(size=18), axis.title = element_text(size=18), 
        legend.text = element_text(size=18), legend.title = element_text(size=18), plot.title = element_text(size=18)) 

### alpha plot
g6 = ggplot(summary, aes(y = as.numeric(beta), x=clean_variable, colour = group)) + 
  geom_point(size = 3) + geom_errorbar(aes(ymin=as.numeric(`lower CI`), ymax=as.numeric(`upper CI`)), width=0, size=0.8, alpha=0.5) +
  scale_x_discrete(limits = rev(levels(summary$clean_variable))) + xlab("") + 
  ylab("beta") + ggtitle("regression,\nShannon") + 
  coord_flip() + scale_y_continuous(trans = 'log10', limits = c(0.33,3), breaks=c(0.5,1,2)) +
  scale_colour_manual(values=c(household = "#CC79A7", infant = "#009E73", maternal = "#56B4E9", rotavirus = "#661100")) + 
  theme(axis.text.y = element_blank(), axis.text.x = element_text(size=18), axis.title = element_text(size=18), 
        legend.text = element_text(size=18), legend.title = element_text(size=18), plot.title = element_text(size=18))
```

##### Significant assocations - Bray-Curtis (fdr p <0.05)
```{r}
subset(summary, fdr_p_u<0.05)[,c("clean_variable", "R2_u", "p_u", "fdr_p_u", "n_samples")]
```

##### Significant assocations - Shannon (fdr p <0.05)
```{r}
subset(summary, fdr_alpha_p<0.05)[,c("clean_variable", "beta", "p", "fdr_alpha_p", "n")]
```

##### Full beta results
```{r}
formattable(beta_collated)
```

##### Full alpha results
```{r}
formattable(alpha_collated)
```



Plot - all countries {.hidden}
=====================================

```{r, fig.width=12, fig.height=18}
plot_grid(
  plot_grid(g1, g3, g5, ncol=1, align = "v", rel_heights = c(3,1.6,1.2)),
  plot_grid(g2, g4, g6, ncol=1, align = "v", rel_heights = c(3,1.6,1.2)),
  rel_widths = c(1.6,1))
```




Alpha diversity vs neonatal RV {.hidden}
=====================================
Column {.tabset .tabset-fade}
-------------------------------------

### Genus-level

#### India vs Malawi vs UK
```{r, fig.width=7, fig.height=3}
# create dataframe of infant samples
t = data.frame(sample_data(rps8_genus))

# updated coding for week
t$week_fig[t$week_fig=="week 1"] = "week of life 1"
t$week_fig[t$week_fig=="week 4"] = "week of life 4"
t$week_fig[t$week_fig=="week 6/8"] = "week of life 6"
t$week_fig[t$week_fig=="week 10/12"] = "week of life 10"
t$week_fig = factor(t$week_fig, levels = c("week of life 1","week of life 4","week of life 6","week of life 10"))

# updated coding for country
t$country_exposure[t$country_exposure=="India (exposed)"] = "neo+"
t$country_exposure[t$country_exposure=="India (unexposed)"] = "neo-"

# select infant samples
t1 = subset(t, sample_type!="MS1" & (country_exposure=="neo+" | country_exposure=="neo-"))

# add-ons for longitudinal plots
gg_add = function(plot) { plot +
    geom_jitter(size = 1, alpha = 0.2, width=0.25) +
    geom_boxplot(alpha = 0.5, outlier.shape = NA) + 
    scale_color_manual("country", values = c("#882255", "#0072B2")) +
    xlab("") + theme(legend.position = "none") + facet_grid(.~week_fig) + theme(strip.background = element_blank()) +
    theme(axis.text = element_text(size = 13), strip.text = element_text(size = 13), axis.title = element_text(size = 13))
  }

# create longitudinal plots for alpha diversity by country
#p1 = gg_add(ggplot(t1, aes(x = factor(week_fig), y = Shannon_rsv, group=family_ID, colour=factor(country))) + ylab("Shannon (variant)") + ylim(0,5)) 
gg_add(ggplot(t1, aes(x = factor(country_exposure), y = Shannon, colour=factor(country_exposure))) + ylab("Shannon")) #+ ylim(0,30) 
#grid.arrange(p1, p2, ncol=2)
```

#### N by timepoint
```{r}
table(t1$sample_type, t1$country_exposure)
```

#### P values, longitudinal mixed-effects models
```{r}
# calculate lme models for pairwise comparisons using lme_alpha
p_shan = lme_alpha(t1, "Shannon", comparison="country_exposure")
p_obs = lme_alpha(t1, "log(Observed)", comparison="country_exposure")
  
data.frame(Shannon = round(p_shan,3) ,Richness = round(p_obs,3))
```

#### P values, cross-sectional models - Shannon
```{r}
p_1 = summary(glm(country_exposure=="neo+" ~ Shannon, data = subset(t1, sample_type=="BS1"), family = binomial))$coefficients[2,4]
p_2 = summary(glm(country_exposure=="neo+" ~ Shannon, data = subset(t1, sample_type=="BS2"), family = binomial))$coefficients[2,4]
p_3 = summary(glm(country_exposure=="neo+" ~ Shannon, data = subset(t1, sample_type=="BS3"), family = binomial))$coefficients[2,4]
p_4 = summary(glm(country_exposure=="neo+" ~ Shannon, data = subset(t1, sample_type=="BS5"), family = binomial))$coefficients[2,4]
data.frame(week = c(1,4,6,10), p = round(c(p_1, p_2, p_3, p_4), 4))
```

#### P values, cross-sectional models - richness
```{r}
p_1 = summary(glm(country_exposure=="neo+" ~ log(Observed), data = subset(t1, sample_type=="BS1"), family = binomial))$coefficients[2,4]
p_2 = summary(glm(country_exposure=="neo+" ~ log(Observed), data = subset(t1, sample_type=="BS2"), family = binomial))$coefficients[2,4]
p_3 = summary(glm(country_exposure=="neo+" ~ log(Observed), data = subset(t1, sample_type=="BS3"), family = binomial))$coefficients[2,4]
p_4 = summary(glm(country_exposure=="neo+" ~ log(Observed), data = subset(t1, sample_type=="BS5"), family = binomial))$coefficients[2,4]
data.frame(week = c(1,4,6,10), p = round(c(p_1, p_2, p_3, p_4), 4))
```


Session info {.hidden}
===================================== 

```{r}
print(sessionInfo())
```
.